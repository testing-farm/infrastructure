---
#
# For documentation see:
# https://docs.ansible.com/ansible/latest/collections/amazon/aws/aws_ec2_inventory.html
#

plugin: amazon.aws.aws_ec2

cache: true
cache_plugin: ansible.builtin.jsonfile
cache_connection: .direnv/aws-cache

boto_profile: fedora_us_east_2

include_filters:
  - tag:ServiceOwner:
      - "TFT"

hostnames:
  - "tag:Name"

compose:
  ansible_host: public_ip_address
  ansible_ssh_private_key_file: ../secrets/ssh/id_rsa_public_worker.decrypted

groups:
  testing_farm_public_workers:
    tags.ServiceOwner == "TFT"
    and tags.ServiceComponent == "Worker"
    and tags.ServicePhase == "Prod"
  testing_farm_public_servers:
    tags.ServiceOwner == "TFT"
    and tags.ServiceComponent == "Server"
    and tags.ServicePhase == "Prod"
  testing_farm_dev_public_workers:
    tags.ServiceOwner == "TFT"
    and tags.ServiceComponent == "Worker"
    and tags.ServicePhase == "Dev"
    and lookup('env', 'USER') in tags.Name
  testing_farm_dev_public_servers:
    tags.ServiceOwner == "TFT"
    and tags.ServiceComponent == "Server"
    and tags.ServicePhase == "Dev"
    and lookup('env', 'USER') in tags.Name
