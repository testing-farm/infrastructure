---

- hosts: testing-farm-public-servers:testing-farm-public-workers
  become: true
  roles:
    - security

- hosts: testing-farm-redhat-servers:testing-farm-redhat-workers
  vars_files:
    - ../secrets/credentials.yml
  tasks:
    - include: ../tasks/rh-certs.yml

- hosts: testing-farm-public-workers:testing-farm-redhat-workers
  vars_files:
    - ../secrets/credentials.yml
  pre_tasks:
    - include: ../tasks/dns.yml
      tags: update_dns
    - include: ../tasks/ssh_key.yml
    - include: ../tasks/podman.yml
    - include: ../tasks/jobs.yml
      tags: update_jobs
    - include: ../tasks/config.yml
      tags: update_config
    - include: ../tasks/xunit-viewer.yml
      tags: update_xunit_viewer
    - include: ../tasks/image.yml
      tags: update_image
  roles:
    - name: disk
      become: true
    - name: nomad
      tags: update_nomad
  tasks:
    - include: ../tasks/jobs-register.yml
      tags: update_jobs
