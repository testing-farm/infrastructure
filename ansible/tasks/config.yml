---
- name: Copy citool configuration
  become: true
  copy:
    # ending `/` is required to copy only contents over
    src: "{{ root_dir }}/ranch/{{ deployment_environment }}/citool-config"
    dest: "/etc/citool.d"
    owner: "root"
    mode: "preserve"

- name: Render config templates
  template:
    src: "{{ item }}"
    dest: "/etc/citool.d/config/{{ item | basename | regex_replace('.j2','') }}"
    mode: 0644
  with_fileglob:
    - "{{ root_dir }}/citool-config/{{ deployment_environment }}/config/*.j2"

- name: Copy Artemis Private Key
  become: true
  copy:
    # ending `/` is required to copy only contents over
    src: "{{ artemis_ssh_private_key }}/"
    dest: "/etc/citool.d/id_rsa_artemis"
    owner: "root"
    mode: 0600

- name: Copy Artemis Public Key
  become: true
  copy:
    # ending `/` is required to copy only contents over
    src: "{{ artemis_ssh_public_key }}/"
    dest: "/etc/citool.d/id_rsa_artemis.pub"
    owner: "root"
    mode: 0600
