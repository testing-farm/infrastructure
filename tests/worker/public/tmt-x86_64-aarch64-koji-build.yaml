---

extends:
  - base-tmt_pipeline
  - base-tmt_checks

marks:
  - public
  - pipeline

variables:
  REQUEST_ID: 56b86bbc-7d6b-4754-bb73-aa48686f48e7
  COMPOSE: Fedora-39
  ARCH: x86_64
  ARCH_32: i686
  RESULT: PASSED
  GIT_CLONE_URL: https://gitlab.com/testing-farm/tests
  GIT_REF: main
  PLAN: /testing-farm/sanity
  SCHEDULE_ENTRIES: 2

checks:
  literal-patterns:
    - "[{{ COMPOSE }}:{{ ARCH }}:{{ PLAN }}] installing the artifact"
    - "[{{ COMPOSE }}:aarch64:{{ PLAN }}] installing the artifact"
    - "[artemis] [{{ artemis_guestname_pattern }}] Download task id vim-9.0.2153-1.fc39"
    - "[artemis] [{{ artemis_guestname_pattern }}] Download task id tmt-1.29.0-1.fc39"
    - "[artemis] [{{ artemis_guestname_pattern }}] Get package list"
    - "[artemis] [{{ artemis_guestname_pattern }}] Reinstall packages"
    - "[artemis] [{{ artemis_guestname_pattern }}] Install packages"
    - "[artemis] [{{ artemis_guestname_pattern }}] Verify all packages installed"

    - table:
        -
          - "{{ COMPOSE }}:aarch64:{{ PLAN }}"
          - CREATED
          - OK
          - UNDEFINED
          - "aarch64 {{ COMPOSE }} S-"
          - ""
          - tmt

    - table:
        -
          - "{{ COMPOSE }}:aarch64:{{ PLAN }}"
          - GUEST_SETUP
          - OK
          - UNDEFINED
          - "aarch64 {{ COMPOSE }} S-"
          - "aarch64 {{ COMPOSE }} S-"
          - tmt

    - table:
        -
          - "{{ COMPOSE }}:aarch64:{{ PLAN }}"
          - RUNNING
          - OK
          - UNDEFINED
          - "aarch64 {{ COMPOSE }} S-"
          - "aarch64 {{ COMPOSE }} S-"
          - tmt

    - table:
        -
          - "{{ COMPOSE }}:aarch64:{{ PLAN }}"
          - CLEANUP
          - OK
          - "{{ RESULT }}"
          - "aarch64 {{ COMPOSE }} S-"
          - "aarch64 {{ COMPOSE }} S-"
          - tmt

    - table:
        -
          - "{{ COMPOSE }}:aarch64:{{ PLAN }}"
          - COMPLETE
          - OK
          - "{{ RESULT }}"
          - "aarch64 {{ COMPOSE }} S-"
          - "aarch64 {{ COMPOSE }} S-"
          - tmt

  literal-patterns[citool-debug.txt]:
    - "koji download-build --debuginfo --task-id --arch noarch --arch {{ ARCH }} --arch {{ ARCH_32 }} --arch src vim-9.0.2153-1.fc39 || koji download-task --arch noarch --arch {{ ARCH }} --arch {{ ARCH_32 }} --arch src vim-9.0.2153-1.fc39"
    - "koji download-build --debuginfo --task-id --arch noarch --arch {{ ARCH }} --arch {{ ARCH_32 }} --arch src tmt-1.29.0-1.fc39 || koji download-task --arch noarch --arch {{ ARCH }} --arch {{ ARCH_32 }} --arch src tmt-1.29.0-1.fc39"
    - "koji download-build --debuginfo --task-id --arch noarch --arch aarch64 --arch src vim-9.0.2153-1.fc39 || koji download-task --arch noarch --arch aarch64 --arch src vim-9.0.2153-1.fc39"
    - "koji download-build --debuginfo --task-id --arch noarch --arch aarch64 --arch src tmt-1.29.0-1.fc39 || koji download-task --arch noarch --arch aarch64 --arch src tmt-1.29.0-1.fc39"
