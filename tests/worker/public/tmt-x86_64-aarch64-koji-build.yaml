---

extends:
  - base-tmt_pipeline
  - base-tmt_checks

marks:
  - public
  - pipeline

variables:
  REQUEST_ID: 9c29b327-2987-4d63-af93-287e4e62b4f8
  COMPOSE: Fedora-Rawhide
  ARCH: x86_64
  ARCH_32: i686
  RESULT: PASSED
  GIT_CLONE_URL: https://gitlab.com/testing-farm/tests
  GIT_REF: main
  PLAN: /testing-farm/sanity
  SCHEDULE_ENTRIES: 2
  NVR1: tzdata-2024b-1.fc42
  NVR2: hwdata-0.391-1.fc42

checks:
  literal-patterns:
    - "[{{ COMPOSE }}:{{ ARCH }}:{{ PLAN }}] installing the artifact"
    - "[{{ COMPOSE }}:aarch64:{{ PLAN }}] installing the artifact"
    - "[artemis] [{{ artemis_guestname_pattern }}] Download task id {{ NVR1 }}"
    - "[artemis] [{{ artemis_guestname_pattern }}] Download task id {{ NVR2 }}"
    - "[artemis] [{{ artemis_guestname_pattern }}] Get package list"
    - "[artemis] [{{ artemis_guestname_pattern }}] Reinstall packages"
    - "[artemis] [{{ artemis_guestname_pattern }}] Install packages"
    - "[artemis] [{{ artemis_guestname_pattern }}] Verify all packages installed"

    - table:
        -
          - "{{ COMPOSE }}:aarch64:{{ PLAN }}"
          - CREATED
          - OK
          - UNDEFINED
          - "aarch64 {{ COMPOSE }} S-"
          - ""
          - tmt

    - table:
        -
          - "{{ COMPOSE }}:aarch64:{{ PLAN }}"
          - GUEST_SETUP
          - OK
          - UNDEFINED
          - "aarch64 {{ COMPOSE }} S-"
          - "aarch64 {{ COMPOSE }} S-"
          - tmt

    - table:
        -
          - "{{ COMPOSE }}:aarch64:{{ PLAN }}"
          - RUNNING
          - OK
          - UNDEFINED
          - "aarch64 {{ COMPOSE }} S-"
          - "aarch64 {{ COMPOSE }} S-"
          - tmt

    - table:
        -
          - "{{ COMPOSE }}:aarch64:{{ PLAN }}"
          - CLEANUP
          - OK
          - "{{ RESULT }}"
          - "aarch64 {{ COMPOSE }} S-"
          - "aarch64 {{ COMPOSE }} S-"
          - tmt

    - table:
        -
          - "{{ COMPOSE }}:aarch64:{{ PLAN }}"
          - COMPLETE
          - OK
          - "{{ RESULT }}"
          - "aarch64 {{ COMPOSE }} S-"
          - "aarch64 {{ COMPOSE }} S-"
          - tmt

  literal-patterns[citool-debug.txt]:
    - "koji download-build --debuginfo --task-id --arch noarch --arch {{ ARCH }} --arch {{ ARCH_32 }} --arch src {{ NVR1 }} || koji download-task --arch noarch --arch {{ ARCH }} --arch {{ ARCH_32 }} --arch src {{ NVR1 }}"
    - "koji download-build --debuginfo --task-id --arch noarch --arch {{ ARCH }} --arch {{ ARCH_32 }} --arch src {{ NVR2 }} || koji download-task --arch noarch --arch {{ ARCH }} --arch {{ ARCH_32 }} --arch src {{ NVR2 }}"
    - "koji download-build --debuginfo --task-id --arch noarch --arch aarch64 --arch src {{ NVR1 }} || koji download-task --arch noarch --arch aarch64 --arch src {{ NVR1 }}"
    - "koji download-build --debuginfo --task-id --arch noarch --arch aarch64 --arch src {{ NVR2 }} || koji download-task --arch noarch --arch aarch64 --arch src {{ NVR2 }}"
