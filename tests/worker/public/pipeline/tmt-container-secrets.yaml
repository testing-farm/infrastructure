---

marks:
  - public

pipeline: |
  hide-secrets
  rules-engine
  testing-farm-request --request-id 4d8925ed-615a-4483-b1a8-b5d92228ed60
  ansible
  static-guest --guest=localhost
  guest-setup-no-playbooks:guest-setup
  git
  coldstore
  testing-farm-request-state-reporter
  test-schedule-tmt
  test-scheduler-testing-farm
  test-schedule-runner
  test-schedule-report

checks:
  literal-strings:
    - "[testing-farm-request] Connected to Testing Farm Service 'https://internal.api.dev.testing-farm.io'"
    - "[testing-farm-request] Initialized with 4d8925ed-615a-4483-b1a8-b5d92228ed60:"
    - "\"<TestingEnvironment(arch=x86_64,artifacts=[],compose=Fedora-Rawhide,secrets=******,snapshots=False,variables=\
      {'SCRIPT': 'echo $SECRET | grep some-secret'})>\""
    - "[static-guest] added guest 'localhost' with architecture "
    - "[git] <RemoteGitRepository(clone_url=https://gitlab.com/testing-farm/tests, branch=not specified, ref=main)>"
    - "[coldstore] For the pipeline artifacts, see https://artifacts.dev.testing-farm.io/4d8925ed-615a-4483-b1a8-b5d92228ed60"
    - "[testing-farm-request-state-reporter] pipeline complete"
    - "[test-schedule-tmt] cloning repo https://gitlab.com/testing-farm/tests (branch not specified, ref main)"
    - "[test-schedule-report] Result of testing: PASSED"
    - "[test-schedule-runner] 1 entries pending:"
    - "[test-schedule-runner] 0 entries pending:"
    - "[test-schedule-runner] finished schedule:"
    - "[test-schedule-report] results saved into results.xml"

# TODO: 'work-*' is a directory that's not a constant for every run, it contains a hash. We're not able to check it
# using current pytest-gluetool tools.
# literal-strings[work-*/testing-farm/sanity/execute/data/testing-farm/script/output.txt]:
#   - |
#     + '[' -z 'echo $SECRET | grep *****' ']'
#     + echo '$SECRET' '|' grep *****
#     $SECRET | grep *****

  literal-patterns:
    - table:
        -
          - "Fedora-Rawhide:x86_64:/testing-farm/sanity"
          - CREATED
          - OK
          - UNDEFINED
          - "x86_64 Fedora-Rawhide S-"
          - ""
          - tmt

    - table:
        -
          - "Fedora-Rawhide:x86_64:/testing-farm/sanity"
          - GUEST_PROVISIONING
          - OK
          - UNDEFINED
          - "x86_64 Fedora-Rawhide S-"
          - ""
          - tmt

    - table:
        -
          - "Fedora-Rawhide:x86_64:/testing-farm/sanity"
          - GUEST_SETUP
          - OK
          - UNDEFINED
          - "x86_64 Fedora-Rawhide S-"
          - "x86_64 None S-"
          - tmt

    - table:
        -
          - "Fedora-Rawhide:x86_64:/testing-farm/sanity"
          - RUNNING
          - OK
          - UNDEFINED
          - "x86_64 Fedora-Rawhide S-"
          - "x86_64 None S-"
          - tmt

    - table:
        -
          - "Fedora-Rawhide:x86_64:/testing-farm/sanity"
          - CLEANUP
          - OK
          - PASSED
          - "x86_64 Fedora-Rawhide S-"
          - "x86_64 None S-"
          - tmt

    - table:
        -
          - "Fedora-Rawhide:x86_64:/testing-farm/sanity"
          - COMPLETE
          - OK
          - PASSED
          - "x86_64 Fedora-Rawhide S-"
          - "x86_64 None S-"
          - tmt

  artifacts:
    - "citool-debug\\.txt"
    - "citool-debug\\.verbose\\.txt"
    - "git-main[a-z0-9]+"
    - "results\\.xml"
    - "work-sanity[a-z0-9]+/tmt-reproducer\\.sh"
