---
summary: Test guest-setup on Fedora 35

provision:
  how: virtual
  image: Fedora-35

prepare:
  - name: pre-artifact-installation
    how: ansible
    playbook: ranch/public/citool-config/guest-setup/pre-artifact-installation/entrypoint.yml
    extra-args: "-e IMAGE_NAME=Fedora-35 -e TESTING_FARM_REQUEST_ID=43e75b22-7fc5-4492-92a7-d24f469a7eba"

  - name: post-artifact-installation
    how: ansible
    playbook: ranch/public/citool-config/guest-setup/post-artifact-installation/entrypoint.yml
    extra-args: "-e IMAGE_NAME=Fedora-35 -e TESTING_FARM_REQUEST_ID=43e75b22-7fc5-4492-92a7-d24f469a7eba"

discover+:
  how: shell
  tests+:
    - name: Test installed koji package
      test: rpm -qi koji

    - name: Test doggo running
      test: ps ax | egrep -o '[S]l.*/usr/local/bin/doggo --pushgateway-url http://pushgateway.dev.testing-farm.io:9091/ --request-id 43e75b22-7fc5-4492-92a7-d24f469a7eba'

    - name: Test kernel updated
      test: dnf install -y kernel-devel-$(uname -r)

    - name: Test for correct koji version
      test: rpm -q koji | grep koji-1\.28\.1
