---
summary: Test guest-setup on CentOS Stream 10

provision:
  how: virtual
  image: https://odcs.stream.centos.org/stream-10/production/latest-CentOS-Stream/compose/BaseOS/x86_64/images/CentOS-Stream-GenericCloud-10-20240322.2.x86_64.qcow2

prepare:
  - name: pre-artifact-installation
    how: ansible
    playbook: ranch/public/citool-config/guest-setup/pre-artifact-installation/entrypoint.yaml
    extra-args: "-e IMAGE_NAME=CentOS-Stream-10"

discover+:
  how: shell
  tests+:
    - name: Test installed koji package
      test: rpm -qi koji

    - name: Test if tag repository added
      test: test -e /etc/yum.repos.d/tag-repository.repo

    - name: Test all repositories work
      test: dnf --enablerepo='*' makecache

    - name: Test EPEL workaround
      test: dnf -y install bats
