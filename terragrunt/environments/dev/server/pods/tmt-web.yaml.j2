apiVersion: v1
kind: Pod
metadata:
  labels:
    app: tmt-web
  name: tmt-web
spec:
  containers:
  # Uvicorn
  - image: quay.io/testing-farm/tmt-web:latest
    args:
    - uvicorn
    name: uvicorn
    ports:
    - containerPort: 8000
      hostPort: 8100
    env:
    - name: REDIS_URL
      value: redis://redis:6379
    - name: API_HOSTNAME
      value: http://tmt.dev-{{ ansible_env.USER }}.testing-farm.io
  # Celery
  - image: quay.io/testing-farm/tmt-web:latest
    args:
    - celery
    name: celery
    env:
      - name: REDIS_URL
        value: redis://redis:6379
      - name: API_HOSTNAME
        value: http://tmt.dev-{{ ansible_env.USER }}.testing-farm.io
  # Redis
  - image: docker.io/library/redis:latest
    name: redis
    ports:
      - containerPort: 6379
        hostPort: 6379
