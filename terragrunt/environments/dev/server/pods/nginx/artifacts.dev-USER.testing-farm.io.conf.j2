server {
    server_name  artifacts.dev-{{ ansible_env.USER }}.testing-farm.io;
    add_header Access-Control-Allow-Origin *;

    root /var/artifacts;
    disable_symlinks off;

    location ~ "^.*\.txt\.gz$" {
        root /archive;
        types { } default_type "text/plain gz";
        add_header  Content-Encoding  gzip;
        gzip off;
        rewrite "^(.*)$" $1 break;
    }

    location ~ "^/.*/" {
    	autoindex on;
    }

    location / {
        allow {{ localhost_public_ip }}/32;
        deny all;
    }

    listen 80;
}
