---
- name: Check for rawhide
  command: "rpm -q fedora-repos-rawhide"
  ignore_errors: true
  register: check_rawhide

- block:
    - name: Update to latest Fedora packages
      command: "dnf -y update *"
      register: update_packages

    - block:
        - name: Restart if kernel updated
          reboot:

        - name: Wait for connection for 5 minutes
          wait_for_connection:
            delay: 5
            timeout: 300

      when: "'kernel-' in update_packages.stdout"

  when: check_rawhide.rc == 0
  # This task is best effort
  ignore_errors: true
