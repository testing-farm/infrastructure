- name: Install Koji
  package:
    name:
      - koji
    state: present
  when: 'ansible_distribution == "Fedora"'

- block:
    - name: Add RCM Repository for RHEL7 and earlier
      yum_repository:
        description: RCMTOOLS repository
        name: rcmtools
        state: present
        gpgcheck: no
        baseurl: "http://download.devel.redhat.com/rel-eng/RCMTOOLS/latest-RCMTOOLS-2-RHEL-{{ ansible_distribution_major_version }}/compose/Server/{{ ansible_architecture }}/os/"

    - name: Install Brewkoji
      package:
        name: brewkoji

  when:
    - 'ansible_distribution == "RedHat" or
       ansible_distribution == "CentOS" or
       ansible_distribution == "OracleLinux"'
    - 'ansible_distribution_major_version <= "7"'

- block:
    - name: Add RCM Repository for RHEL8
      yum_repository:
        description: RCMTOOLS repository
        name: rcmtools
        state: present
        gpgcheck: no
        baseurl: "http://download.devel.redhat.com/rel-eng/RCMTOOLS/latest-RCMTOOLS-2-RHEL-{{ ansible_distribution_major_version }}/compose/BaseOS/{{ ansible_architecture }}/os/"

    - name: Install Brewkoji
      package:
        name: brewkoji

  when:
    - 'ansible_distribution == "RedHat" or
       ansible_distribution == "CentOS" or
       ansible_distribution == "OracleLinux"'
    - 'ansible_distribution_major_version == "8"'

- block:
    - name: Install brewkoji from Fedora 33 for RHEL9 (workaround)
      command: "dnf -y install --nogpgcheck https://kojipkgs.fedoraproject.org//packages/koji/1.23.0/2.fc33/noarch/koji-1.23.0-2.fc33.noarch.rpm https://kojipkgs.fedoraproject.org//packages/koji/1.23.0/2.fc33/noarch/python3-koji-1.23.0-2.fc33.noarch.rpm http://download.devel.redhat.com/rel-eng/RCMTOOLS/RCMTOOLS-2.0-updates-F-33-20210105.0/compose/Everything/x86_64/os/Packages/brewkoji-1.26-1.fc33eng.noarch.rpm http://download.devel.redhat.com/rel-eng/RCMTOOLS/RCMTOOLS-2.0-updates-F-33-20210105.0/compose/Everything/x86_64/os/Packages/python3-brewkoji-1.26-1.fc33eng.noarch.rpm http://download.eng.bos.redhat.com/brewroot/vol/rhel-9/packages/pyOpenSSL/20.0.1/2.el9/noarch/python3-pyOpenSSL-20.0.1-2.el9.noarch.rpm"

  when:
    - 'ansible_distribution == "RedHat"'
    - 'ansible_distribution_major_version == "9"'
